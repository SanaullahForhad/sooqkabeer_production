{% extends "base.html" %}

{% block title %}Vendor Registration - SooqKabeer B2B Marketplace{% endblock %}

{% block styles %}
<style>
    /* Vendor Registration Styles */
    :root {
        --reg-primary: #f5576c;
        --reg-secondary: #f093fb;
        --reg-success: #4cd964;
        --reg-warning: #ff9500;
        --reg-info: #5ac8fa;
    }

    .registration-hero {
        background: linear-gradient(135deg, var(--reg-primary) 0%, var(--reg-secondary) 100%);
        color: white;
        padding: 40px 0;
        border-radius: 20px;
        margin-bottom: 30px;
    }

    .registration-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }

    .registration-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(50, 50, 93, 0.1), 0 5px 15px rgba(0, 0, 0, 0.07);
        overflow: hidden;
        margin-bottom: 30px;
    }

    /* Progress Steps */
    .progress-steps {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 30px 40px;
        background: #f8f9fa;
        position: relative;
    }

    .progress-steps::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50px;
        right: 50px;
        height: 2px;
        background: #e3e6f0;
        z-index: 1;
    }

    .step {
        position: relative;
        z-index: 2;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .step-circle {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: white;
        border: 2px solid #e3e6f0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #6e707e;
        margin-bottom: 10px;
        transition: all 0.3s;
    }

    .step.active .step-circle {
        background: var(--reg-primary);
        border-color: var(--reg-primary);
        color: white;
        box-shadow: 0 5px 15px rgba(245, 87, 108, 0.3);
    }

    .step.completed .step-circle {
        background: var(--reg-success);
        border-color: var(--reg-success);
        color: white;
    }

    .step-label {
        font-size: 0.875rem;
        color: #6e707e;
        font-weight: 500;
    }

    .step.active .step-label {
        color: var(--reg-primary);
        font-weight: 600;
    }

    /* Form Sections */
    .form-section {
        padding: 40px;
        display: none;
        animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .form-section.active {
        display: block;
    }

    .section-header {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #e3e6f0;
    }

    .section-header h3 {
        color: #5a5c69;
        margin-bottom: 10px;
    }

    .section-header p {
        color: #858796;
        margin: 0;
    }

    /* Form Groups */
    .form-row {
        display: flex;
        flex-wrap: wrap;
        margin: 0 -15px;
    }

    .form-col {
        flex: 1;
        padding: 0 15px;
        min-width: 300px;
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #5a5c69;
        display: flex;
        align-items: center;
    }

    .form-label .required {
        color: var(--reg-primary);
        margin-left: 4px;
    }

    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e3e6f0;
        border-radius: 10px;
        font-size: 0.95rem;
        transition: all 0.3s;
        background: white;
    }

    .form-control:focus {
        border-color: var(--reg-primary);
        box-shadow: 0 0 0 0.2rem rgba(245, 87, 108, 0.25);
        outline: none;
    }

    .form-control.has-error {
        border-color: var(--reg-primary);
    }

    .error-message {
        color: var(--reg-primary);
        font-size: 0.8rem;
        margin-top: 5px;
        display: none;
    }

    .error-message.show {
        display: block;
    }

    /* Password Strength Meter */
    .password-strength {
        margin-top: 10px;
    }

    .strength-bar {
        height: 5px;
        background: #e3e6f0;
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 5px;
    }

    .strength-fill {
        height: 100%;
        width: 0;
        border-radius: 3px;
        transition: all 0.3s;
    }

    .strength-text {
        font-size: 0.75rem;
        color: #6e707e;
    }

    /* File Upload */
    .file-upload-area {
        border: 2px dashed #e3e6f0;
        border-radius: 10px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        background: #f8f9fc;
    }

    .file-upload-area:hover {
        border-color: var(--reg-primary);
        background: rgba(245, 87, 108, 0.05);
    }

    .file-upload-area.drag-over {
        border-color: var(--reg-primary);
        background: rgba(245, 87, 108, 0.1);
    }

    .upload-icon {
        font-size: 48px;
        color: #dddfeb;
        margin-bottom: 15px;
    }

    .file-preview {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 20px;
    }

    .file-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
        border-radius: 10px;
        overflow: hidden;
    }

    .file-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .remove-file {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(231, 74, 59, 0.9);
        color: white;
        border: none;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 12px;
    }

    /* Terms & Conditions */
    .terms-box {
        background: #f8f9fc;
        border: 1px solid #e3e6f0;
        border-radius: 10px;
        padding: 20px;
        max-height: 200px;
        overflow-y: auto;
        margin-bottom: 20px;
    }

    .terms-box p {
        margin-bottom: 15px;
        color: #5a5c69;
        line-height: 1.6;
    }

    /* Form Actions */
    .form-actions {
        display: flex;
        justify-content: space-between;
        padding-top: 30px;
        border-top: 1px solid #e3e6f0;
        margin-top: 30px;
    }

    .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .btn-prev {
        background: #f8f9fc;
        color: #5a5c69;
        border: 1px solid #e3e6f0;
    }

    .btn-prev:hover {
        background: #e3e6f0;
    }

    .btn-next {
        background: linear-gradient(135deg, var(--reg-primary) 0%, var(--reg-secondary) 100%);
        color: white;
    }

    .btn-next:hover {
        transform: translateY(-2px);
        box-shadow: 0 7px 14px rgba(245, 87, 108, 0.2);
    }

    .btn-submit {
        background: var(--reg-success);
        color: white;
        width: 100%;
    }

    .btn-submit:hover {
        background: #2ecc71;
        transform: translateY(-2px);
        box-shadow: 0 7px 14px rgba(46, 204, 113, 0.2);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .progress-steps::before {
            left: 30px;
            right: 30px;
        }

        .form-section {
            padding: 20px;
        }

        .form-col {
            min-width: 100%;
        }

        .form-actions {
            flex-direction: column;
            gap: 15px;
        }

        .form-actions .btn {
            width: 100%;
        }
    }

    /* Success Message */
    .success-message {
        text-align: center;
        padding: 60px 40px;
    }

    .success-icon {
        font-size: 80px;
        color: var(--reg-success);
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="registration-container">
    <!-- Hero Section -->
    <div class="registration-hero text-center">
        <h1 class="mb-3">Become a Vendor on SooqKabeer</h1>
        <p class="lead mb-0">Join Kuwait's premier B2B wholesale marketplace. Grow your business with us.</p>
    </div>

    <!-- Registration Form -->
    <div class="registration-card">
        <!-- Progress Steps -->
        <div class="progress-steps">
            <div class="step active" data-step="1">
                <div class="step-circle">
                    <i class="fas fa-user"></i>
                </div>
                <span class="step-label">Account Info</span>
            </div>
            <div class="step" data-step="2">
                <div class="step-circle">
                    <i class="fas fa-store"></i>
                </div>
                <span class="step-label">Business Info</span>
            </div>
            <div class="step" data-step="3">
                <div class="step-circle">
                    <i class="fas fa-file-alt"></i>
                </div>
                <span class="step-label">Documents</span>
            </div>
            <div class="step" data-step="4">
                <div class="step-circle">
                    <i class="fas fa-check-circle"></i>
                </div>
                <span class="step-label">Review & Submit</span>
            </div>
        </div>

        <form id="vendorRegForm" action="/vendor/register" method="POST" enctype="multipart/form-data">
            <!-- Step 1: Account Information -->
            <div class="form-section active" id="section1">
                <div class="section-header">
                    <h3><i class="fas fa-user text-primary me-2"></i> Account Information</h3>
                    <p>Create your vendor account with personal details</p>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Full Name <span class="required">*</span>
                            </label>
                            <input type="text" name="name" class="form-control" 
                                   placeholder="Example: Ahmed Al-Salem" required
                                   data-validation="name">
                            <div class="error-message" id="name-error"></div>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Email Address <span class="required">*</span>
                            </label>
                            <input type="email" name="email" class="form-control" 
                                   placeholder="ahmed@example.com" required
                                   data-validation="email">
                            <div class="error-message" id="email-error"></div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Phone Number <span class="required">*</span>
                            </label>
                            <div class="input-group">
                                <div style="flex: 0 0 100px;">
                                    <select name="country_code" class="form-control">
                                        <option value="+965">+965 (Kuwait)</option>
                                        <option value="+966">+966 (KSA)</option>
                                        <option value="+971">+971 (UAE)</option>
                                        <option value="+973">+973 (Bahrain)</option>
                                    </select>
                                </div>
                                <input type="tel" name="phone" class="form-control" 
                                       placeholder="5XX XXXXXX" required
                                       data-validation="phone">
                            </div>
                            <div class="error-message" id="phone-error"></div>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Nationality
                            </label>
                            <select name="nationality" class="form-control">
                                <option value="">Select Nationality</option>
                                <option value="kuwaiti">Kuwaiti</option>
                                <option value="saudi">Saudi</option>
                                <option value="emirati">Emirati</option>
                                <option value="other_arab">Other Arab</option>
                                <option value="asian">Asian</option>
                                <option value="european">European</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Password <span class="required">*</span>
                            </label>
                            <input type="password" name="password" id="password" class="form-control" 
                                   placeholder="Minimum 8 characters" required
                                   data-validation="password">
                            <div class="password-strength">
                                <div class="strength-bar">
                                    <div class="strength-fill" id="strength-fill"></div>
                                </div>
                                <div class="strength-text" id="strength-text">Password strength</div>
                            </div>
                            <div class="error-message" id="password-error"></div>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Confirm Password <span class="required">*</span>
                            </label>
                            <input type="password" name="confirm_password" id="confirm_password" 
                                   class="form-control" placeholder="Re-enter your password" required>
                            <div class="error-message" id="confirm-password-error"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Business Information -->
            <div class="form-section" id="section2">
                <div class="section-header">
                    <h3><i class="fas fa-store text-primary me-2"></i> Business Information</h3>
                    <p>Tell us about your business</p>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Business Name <span class="required">*</span>
                            </label>
                            <input type="text" name="business_name" class="form-control" 
                                   placeholder="Example: Al-Salem Trading Co." required>
                            <small class="text-muted">This will be displayed to customers</small>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Business Type <span class="required">*</span>
                            </label>
                            <select name="business_type" class="form-control" required>
                                <option value="">Select Business Type</option>
                                <option value="wholesaler">Wholesaler</option>
                                <option value="manufacturer">Manufacturer</option>
                                <option value="distributor">Distributor</option>
                                <option value="retailer">Retailer</option>
                                <option value="importer">Importer</option>
                                <option value="exporter">Exporter</option>
                                <option value="service_provider">Service Provider</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Commercial Registration Number <span class="required">*</span>
                            </label>
                            <input type="text" name="cr_number" class="form-control" 
                                   placeholder="e.g., 1234567" required>
                            <small class="text-muted">Required for business verification</small>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Tax/VAT Number
                            </label>
                            <input type="text" name="vat_number" class="form-control" 
                                   placeholder="VAT/Tax identification number">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        Business Address <span class="required">*</span>
                    </label>
                    <div class="form-row">
                        <div class="form-col">
                            <select name="governorate" class="form-control" required>
                                <option value="">Select Governorate</option>
                                <option value="hawalli">Hawalli</option>
                                <option value="asima">Al Asimah</option>
                                <option value="jahra">Al Jahra</option>
                                <option value="farwaniya">Al Farwaniyah</option>
                                <option value="mubarak_al_kabeer">Mubarak Al-Kabeer</option>
                                <option value="ahmadi">Al Ahmadi</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <input type="text" name="block" class="form-control" placeholder="Block Number" required>
                        </div>
                        <div class="form-col">
                            <input type="text" name="street" class="form-control" placeholder="Street Name" required>
                        </div>
                    </div>
                    <div class="form-row mt-3">
                        <div class="form-col">
                            <input type="text" name="building" class="form-control" placeholder="Building Name/No." required>
                        </div>
                        <div class="form-col">
                            <input type="text" name="floor" class="form-control" placeholder="Floor No.">
                        </div>
                        <div class="form-col">
                            <input type="text" name="unit" class="form-control" placeholder="Unit/Office No.">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Business Description</label>
                    <textarea name="business_description" class="form-control" rows="4" 
                              placeholder="Describe your business, products, and services..."></textarea>
                    <small class="text-muted">This will appear on your vendor profile</small>
                </div>
            </div>

            <!-- Step 3: Documents -->
            <div class="form-section" id="section3">
                <div class="section-header">
                    <h3><i class="fas fa-file-alt text-primary me-2"></i> Required Documents</h3>
                    <p>Upload required documents for verification</p>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Civil ID (Front) <span class="required">*</span>
                            </label>
                            <div class="file-upload-area" id="civilIdUpload">
                                <div class="upload-icon">
                                    <i class="fas fa-id-card"></i>
                                </div>
                                <h5>Upload Civil ID Front</h5>
                                <p class="text-muted">Click to upload or drag and drop</p>
                                <p class="text-muted">PNG, JPG, PDF up to 5MB</p>
                                <input type="file" name="civil_id_front" class="d-none" 
                                       accept=".png,.jpg,.jpeg,.pdf" required>
                            </div>
                            <div class="file-preview" id="civilIdPreview"></div>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Civil ID (Back) <span class="required">*</span>
                            </label>
                            <div class="file-upload-area" id="civilIdBackUpload">
                                <div class="upload-icon">
                                    <i class="fas fa-id-card"></i>
                                </div>
                                <h5>Upload Civil ID Back</h5>
                                <p class="text-muted">Click to upload or drag and drop</p>
                                <p class="text-muted">PNG, JPG, PDF up to 5MB</p>
                                <input type="file" name="civil_id_back" class="d-none" 
                                       accept=".png,.jpg,.jpeg,.pdf" required>
                            </div>
                            <div class="file-preview" id="civilIdBackPreview"></div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Commercial License <span class="required">*</span>
                            </label>
                            <div class="file-upload-area" id="licenseUpload">
                                <div class="upload-icon">
                                    <i class="fas fa-file-contract"></i>
                                </div>
                                <h5>Upload Commercial License</h5>
                                <p class="text-muted">Click to upload or drag and drop</p>
                                <p class="text-muted">PNG, JPG, PDF up to 10MB</p>
                                <input type="file" name="commercial_license" class="d-none" 
                                       accept=".png,.jpg,.jpeg,.pdf" required>
                            </div>
                            <div class="file-preview" id="licensePreview"></div>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label">
                                Additional Documents (Optional)
                            </label>
                            <div class="file-upload-area" id="additionalUpload">
                                <div class="upload-icon">
                                    <i class="fas fa-folder-plus"></i>
                                </div>
                                <h5>Upload Additional Documents</h5>
                                <p class="text-muted">Trade certificate, VAT certificate, etc.</p>
                                <p class="text-muted">Multiple files allowed</p>
                                <input type="file" name="additional_docs[]" class="d-none" 
                                       accept=".png,.jpg,.jpeg,.pdf,.doc,.docx" multiple>
                            </div>
                            <div class="file-preview" id="additionalPreview"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Review & Submit -->
            <div class="form-section" id="section4">
                <div class="section-header">
                    <h3><i class="fas fa-check-circle text-primary me-2"></i> Review & Submit</h3>
                    <p>Review your information before submission</p>
                </div>

                <div class="review-summary">
                    <div class="review-section mb-4">
                        <h5 class="mb-3"><i class="fas fa-user me-2"></i> Account Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Name:</strong> <span id="review-name">-</span></p>
                                <p><strong>Email:</strong> <span id="review-email">-</span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Phone:</strong> <span id="review-phone">-</span></p>
                                <p><strong>Nationality:</strong> <span id="review-nationality">-</span></p>
                            </div>
                        </div>
                    </div>

                    <div class="review-section mb-4">
                        <h5 class="mb-3"><i class="fas fa-store me-2"></i> Business Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Business Name:</strong> <span id="review-business-name">-</span></p>
                                <p><strong>Business Type:</strong> <span id="review-business-type">-</span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>CR Number:</strong> <span id="review-cr-number">-</span></p>
                                <p><strong>Address:</strong> <span id="review-address">-</span></p>
                            </div>
                        </div>
                    </div>

                    <div class="review-section mb-4">
                        <h5 class="mb-3"><i class="fas fa-file-alt me-2"></i> Documents</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Civil ID:</strong> <span id="review-civil-id">Ready</span></p>
                                <p><strong>Commercial License:</strong> <span id="review-license">Ready</span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Additional Docs:</strong> <span id="review-additional">0 files</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Terms & Conditions -->
                <div class="terms-box">
                    <h6>Terms & Conditions</h6>
                    <p>By registering as a vendor on SooqKabeer, you agree to:</p>
                    <p>1. Provide accurate and truthful information about your business.</p>
                    <p>2. Maintain product quality and timely delivery as promised.</p>
                    <p>3. Comply with Kuwaiti laws and regulations.</p>
                    <p>4. Pay applicable commission fees on successful transactions.</p>
                    <p>5. Resolve customer disputes professionally and promptly.</p>
                    <p>6. Maintain proper documentation and licenses as required.</p>
                </div>

                <div class="form-group">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="agree_terms" id="agreeTerms" required>
                        <label class="form-check-label" for="agreeTerms">
                            I agree to the Terms & Conditions and understand that my application will be reviewed within 3-5 business days.
                        </label>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" class="btn btn-prev" id="prevBtn">
                    <i class="fas fa-arrow-left me-2"></i> Previous
                </button>
                <button type="button" class="btn btn-next" id="nextBtn">
                    Next <i class="fas fa-arrow-right ms-2"></i>
                </button>
                <button type="submit" class="btn btn-submit" id="submitBtn" style="display: none;">
                    <i class="fas fa-paper-plane me-2"></i> Submit Application
                </button>
            </div>
        </form>
    </div>

    <!-- Already have account -->
    <div class="text-center mt-4">
        <p>Already have a vendor account? <a href="/vendor/login" class="text-primary">Login here</a></p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Form State Management
    let currentStep = 1;
    const totalSteps = 4;
    const formData = {};

    // Initialize form
    function initForm() {
        updateSteps();
        setupEventListeners();
        setupFileUploads();
        setupPasswordStrength();
        setupReviewUpdate();
    }

    // Update step indicators
    function updateSteps() {
        // Update step circles
        document.querySelectorAll('.step').forEach((step, index) => {
            const stepNum = index + 1;
            step.classList.remove('active', 'completed');
            
            if (stepNum === currentStep) {
                step.classList.add('active');
            } else if (stepNum < currentStep) {
                step.classList.add('completed');
            }
        });

        // Show current section
        document.querySelectorAll('.form-section').forEach(section => {
            section.classList.remove('active');
        });
        document.getElementById(`section${currentStep}`).classList.add('active');

        // Update buttons
        document.getElementById('prevBtn').style.display = currentStep === 1 ? 'none' : 'inline-flex';
        document.getElementById('nextBtn').style.display = currentStep === totalSteps ? 'none' : 'inline-flex';
        document.getElementById('submitBtn').style.display = currentStep === totalSteps ? 'inline-flex' : 'none';
    }

    // Setup event listeners
    function setupEventListeners() {
        // Next button
        document.getElementById('nextBtn').addEventListener('click', () => {
            if (validateCurrentStep()) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    updateSteps();
                    updateReview();
                    scrollToTop();
                }
            }
        });

        // Previous button
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentStep > 1) {
                currentStep--;
                updateSteps();
                scrollToTop();
            }
        });

        // Form submission
        document.getElementById('vendorRegForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (validateAllSteps()) {
                // Show loading state
                const submitBtn = document.getElementById('submitBtn');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<span class="loading-spinner"></span> Processing...';
                submitBtn.disabled = true;

                // Submit form
                setTimeout(() => {
                    this.submit();
                }, 1500);
            }
        });

        // Live validation for inputs
        document.querySelectorAll('[data-validation]').forEach(input => {
            input.addEventListener('blur', validateField);
            input.addEventListener('input', validateField);
        });

        // Update review on input
        document.querySelectorAll('#vendorRegForm input, #vendorRegForm select, #vendorRegForm textarea').forEach(element => {
            element.addEventListener('change', updateReview);
            element.addEventListener('input', updateReview);
        });
    }

    // Setup file uploads
    function setupFileUploads() {
        const uploads = [
            { id: 'civilIdUpload', input: 'civil_id_front', preview: 'civilIdPreview' },
            { id: 'civilIdBackUpload', input: 'civil_id_back', preview: 'civilIdBackPreview' },
            { id: 'licenseUpload', input: 'commercial_license', preview: 'licensePreview' },
            { id: 'additionalUpload', input: 'additional_docs[]', preview: 'additionalPreview' }
        ];

        uploads.forEach(upload => {
            const area = document.getElementById(upload.id);
            const input = area.querySelector('input[type="file"]');
            const preview = document.getElementById(upload.preview);

            area.addEventListener('click', () => input.click());

            // Drag and drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                area.addEventListener(eventName, preventDefaults, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                area.addEventListener(eventName, () => area.classList.add('drag-over'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                area.addEventListener(eventName, () => area.classList.remove('drag-over'), false);
            });

            area.addEventListener('drop', handleDrop, false);
            input.addEventListener('change', handleFileSelect, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            function handleFileSelect(e) {
                const files = e.target.files;
                handleFiles(files);
            }

            function handleFiles(files) {
                Array.from(files).forEach(file => {
                    if (validateFile(file)) {
                        previewFile(file);
                    }
                });
            }

            function validateFile(file) {
                const maxSize = upload.input === 'commercial_license' ? 10 * 1024 * 1024 : 5 * 1024 * 1024;
                const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf'];
                
                if (!allowedTypes.includes(file.type)) {
                    alert('Please upload only JPG, PNG, or PDF files');
                    return false;
                }
                
                if (file.size > maxSize) {
                    alert(`File size must be less than ${maxSize / (1024 * 1024)}MB`);
                    return false;
                }
                
                return true;
            }

            function previewFile(file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'file-preview-item';
                    
                    if (file.type.startsWith('image/')) {
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="${file.name}">
                            <button type="button" class="remove-file" onclick="removeFile(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    } else {
                        previewItem.innerHTML = `
                            <div class="d-flex align-items-center justify-content-center h-100 bg-light">
                                <i class="fas fa-file-pdf fa-3x text-danger"></i>
                            </div>
                            <button type="button" class="remove-file" onclick="removeFile(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    }
                    
                    preview.appendChild(previewItem);
                };
                
                reader.readAsDataURL(file);
            }
        });
    }

    // Setup password strength meter
    function setupPasswordStrength() {
        const passwordInput = document.getElementById('password');
        const strengthFill = document.getElementById('strength-fill');
        const strengthText = document.getElementById('strength-text');

        passwordInput.addEventListener('input', function() {
            const password = this.value;
            const strength = calculatePasswordStrength(password);
            
            strengthFill.style.width = `${strength.score * 25}%`;
            
            switch(stressness.score) {
                case 0:
                case 1:
                    strengthFill.style.backgroundColor = '#e74a3b';
                    strengthText.textContent = 'Weak';
                    break;
                case 2:
                    strengthFill.style.backgroundColor = '#f6c23e';
                    strengthText.textContent = 'Fair';
                    break;
                case 3:
                    strengthFill.style.backgroundColor = '#1cc88a';
                    strengthText.textContent = 'Good';
                    break;
                case 4:
                    strengthFill.style.backgroundColor = '#4cd964';
                    strengthText.textContent = 'Strong';
                    break;
            }
        });

        function calculatePasswordStrength(password) {
            let score = 0;
            
            // Length check
            if (password.length >= 8) score++;
            if (password.length >= 12) score++;
            
            // Complexity checks
            if (/[a-z]/.test(password)) score++;
            if (/[A-Z]/.test(password)) score++;
            if (/[0-9]/.test(password)) score++;
            if (/[^A-Za-z0-9]/.test(password)) score++;
            
            // Cap at 4
            return { score: Math.min(score, 4) };
        }
    }

    // Setup review update
    function setupReviewUpdate() {
        // Initialize review with form data
        updateReview();
    }

    // Update review section
    function updateReview() {
        // Account info
        document.getElementById('review-name').textContent = 
            document.querySelector('input[name="name"]').value || '-';
        document.getElementById('review-email').textContent = 
            document.querySelector('input[name="email"]').value || '-';
        
        const phoneCode = document.querySelector('select[name="country_code"]').value;
        const phoneNumber = document.querySelector('input[name="phone"]').value;
        document.getElementById('review-phone').textContent = 
            phoneNumber ? `${phoneCode} ${phoneNumber}` : '-';
        
        document.getElementById('review-nationality').textContent = 
            document.querySelector('select[name="nationality"]').value || '-';

        // Business info
        document.getElementById('review-business-name').textContent = 
            document.querySelector('input[name="business_name"]').value || '-';
        document.getElementById('review-business-type').textContent = 
            document.querySelector('select[name="business_type"]').value || '-';
        document.getElementById('review-cr-number').textContent = 
            document.querySelector('input[name="cr_number"]').value || '-';
        
        // Address
        const governorate = document.querySelector('select[name="governorate"]').value;
        const block = document.querySelector('input[name="block"]').value;
        const street = document.querySelector('input[name="street"]').value;
        const building = document.querySelector('input[name="building"]').value;
        
        if (governorate && block) {
            document.getElementById('review-address').textContent = 
                `${building ? building + ', ' : ''}${street ? street + ', ' : ''}Block ${block}, ${governorate}`;
        } else {
            document.getElementById('review-address').textContent = '-';
        }

        // Documents
        const civilIdFiles = document.querySelector('input[name="civil_id_front"]').files.length;
        const licenseFiles = document.querySelector('input[name="commercial_license"]').files.length;
        const additionalFiles = document.querySelector('input[name="additional_docs[]"]').files.length;
        
        document.getElementById('review-civil-id').textContent = civilIdFiles > 0 ? 'Uploaded' : 'Pending';
        document.getElementById('review-license').textContent = licenseFiles > 0 ? 'Uploaded' : 'Pending';
        document.getElementById('review-additional').textContent = `${additionalFiles} file${additionalFiles !== 1 ? 's' : ''}`;
    }

    // Validation functions
    function validateCurrentStep() {
        let isValid = true;
        
        // Get all required fields in current step
        const currentSection = document.getElementById(`section${currentStep}`);
        const requiredFields = currentSection.querySelectorAll('[required]');
        
        requiredFields.forEach(field => {
            if (!validateField({ target: field })) {
                isValid = false;
            }
        });
        
        // Special validation for step 1 (password match)
        if (currentStep === 1) {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            
            if (password !== confirmPassword) {
                showError('confirm-password-error', 'Passwords do not match');
                isValid = false;
            } else {
                hideError('confirm-password-error');
            }
        }
        
        // Special validation for step 3 (files)
        if (currentStep === 3) {
            const requiredFiles = [
                'civil_id_front',
                'civil_id_back',
                'commercial_license'
            ];
            
            requiredFiles.forEach(fileName => {
                const input = document.querySelector(`input[name="${fileName}"]`);
                if (!input.files.length) {
                    showError(`${fileName}-error`, 'This file is required');
                    isValid = false;
                }
            });
        }
        
        return isValid;
    }

    function validateAllSteps() {
        for (let i = 1; i <= totalSteps; i++) {
            currentStep = i;
            if (!validateCurrentStep()) {
                updateSteps();
                alert(`Please complete all required fields in Step ${i}`);
                return false;
            }
        }
        return true;
    }

    function validateField(e) {
        const field = e.target;
        const value = field.value.trim();
        const validationType = field.dataset.validation;
        const errorId = `${field.name}-error`;
        
        // Clear previous error
        hideError(errorId);
        field.classList.remove('has-error');
        
        // Required field validation
        if (field.hasAttribute('required') && !value) {
            showError(errorId, 'This field is required');
            field.classList.add('has-error');
            return false;
        }
        
        // Type-specific validation
        if (validationType && value) {
            let isValid = true;
            let errorMessage = '';
            
            switch(validationType) {
                case 'email':
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    isValid = emailRegex.test(value);
                    errorMessage = 'Please enter a valid email address';
                    break;
                    
                case 'phone':
                    const phoneRegex = /^[569]\d{7}$/;
                    isValid = phoneRegex.test(value);
                    errorMessage = 'Please enter a valid Kuwaiti phone number (starting with 5, 6, or 9)';
                    break;
                    
                case 'password':
                    isValid = value.length >= 8;
                    errorMessage = 'Password must be at least 8 characters long';
                    break;
                    
                case 'name':
                    isValid = value.length >= 2;
                    errorMessage = 'Name must be at least 2 characters long';
                    break;
            }
            
            if (!isValid) {
                showError(errorId, errorMessage);
                field.classList.add('has-error');
                return false;
            }
        }
        
        return true;
    }

    function showError(errorId, message) {
        const errorElement = document.getElementById(errorId);
        if (errorElement) {
            errorElement.textContent = message;
            errorElement.classList.add('show');
        }
    }

    function hideError(errorId) {
        const errorElement = document.getElementById(errorId);
        if (errorElement) {
            errorElement.classList.remove('show');
        }
    }

    // Utility functions
    function removeFile(button) {
        const previewItem = button.closest('.file-preview-item');
        previewItem.remove();
    }

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Initialize form when page loads
    document.addEventListener('DOMContentLoaded', initForm);
</script>
{% endblock %}
