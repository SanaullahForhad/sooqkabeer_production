{% extends "admin_panel.html" %}

{% block admin_content %}
<div class="container-fluid py-4" dir="{% if session.get('lang') == 'ar' %}rtl{% else %}ltr{% endif %}">
    
    <div class="card border-0 shadow-sm mb-4 bg-primary text-white">
        <div class="card-body p-4">
            <h2 class="fw-bold mb-1">
                {% if session.get('lang') == 'ar' %}ðŸ”— Ø¥Ø¯Ø§Ø±Ø© Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©{% else %}ðŸ”— Referral Management{% endif %}
            </h2>
            <p class="mb-0 opacity-75">
                {% if session.get('lang') == 'ar' %}ØªØªØ¨Ø¹ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø±ÙˆØ§Ø¨Ø· Ø¥Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†{% else %}Track and manage vendor referral links{% endif %}
            </p>
        </div>
    </div>

    <div class="card border-0 shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light text-secondary">
                        <tr>
                            <th class="px-4">{% if session.get('lang') == 'ar' %}Ø§Ù„Ø¨Ø§Ø¦Ø¹{% else %}Vendor{% endif %}</th>
                            <th>{% if session.get('lang') == 'ar' %}ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©{% else %}Referral Code{% endif %}</th>
                            <th>{% if session.get('lang') == 'ar' %}Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª{% else %}Visits{% endif %}</th>
                            <th>{% if session.get('lang') == 'ar' %}Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª{% else %}Signups{% endif %}</th>
                            <th class="text-center">{% if session.get('lang') == 'ar' %}Ø®ÙŠØ§Ø±Ø§Øª{% else %}Actions{% endif %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ref in referrals %}
                        <tr>
                            <td class="px-4">
                                <span class="fw-bold text-dark">{{ ref.vendor_name }}</span>
                            </td>
                            <td><code class="bg-light px-2 py-1 rounded text-primary">{{ ref.code }}</code></td>
                            <td><span class="badge bg-soft-info text-info">{{ ref.clicks }}</span></td>
                            <td><span class="badge bg-soft-success text-success">{{ ref.conversions }}</span></td>
                            <td class="text-center">
                                <button class="btn btn-sm btn-outline-primary" onclick="copyLink('{{ ref.code }}')">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="text-center py-5">
                                <p class="text-muted">No referral data found.</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    function copyLink(code) {
        const url = window.location.origin + "/register?ref=" + code;
        navigator.clipboard.writeText(url);
        alert('{% if session.get("lang") == "ar" %}ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!{% else %}Link Copied!{% endif %}');
    }
</script>

<style>
    .bg-soft-info { background: #e0f2fe; }
    .bg-soft-success { background: #dcfce7; }
</style>
{% endblock %}

